<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pong Game</title>
    <style>
        body
        {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #000; 
            margin: 0;
        }
        canvas 
        {
            border: 1px solid #fff;
        }
    </style>
</head>
<body>
    <canvas id="pongCanvas" width="800" height="600"></canvas>
    <script>
        const canvas = document.getElementById('pongCanvas');
        const context = canvas.getContext('2d');

        // Tamaño del borde
        const canvasWidth = canvas.width;
        const canvasHeight = canvas.height;

        // Tamaño de las barras y la pelota
        const paddleWidth = 10;
        const paddleHeight = 100;
        const ballSize = 20;
        const paddleOffset = 20;  // Desplazamiento desde los bordes del mapa

        // Posiciones iniciales
        let playerX = paddleOffset;
        let playerY = (canvasHeight - paddleHeight) / 2;
        let aiX = canvasWidth - paddleWidth - paddleOffset;
        let aiY = (canvasHeight - paddleHeight) / 2;
        let ballX = (canvasWidth - ballSize) / 2;
        let ballY = (canvasHeight - ballSize) / 2;

        // Velocidades
        let playerSpeed = 0;
        let aiSpeed = 4;
        let ballSpeedX = 4;
        let ballSpeedY = 4;

        // Incremento de velocidad
        const speedIncrement = 0.1;

        // Puntuaciones
        let playerScore = 0;
        let aiScore = 0;

        // Cargar la imagen de la pelota
        const ballImage = new Image();
        ballImage.src = '/static/pong/mario.png';


        // Verificar que la imagen se haya cargado
        ballImage.onload = function() 
        {
            console.log('Imagen de la pelota cargada');
            gameLoop();
        };
        
        ballImage.onerror = function() 
        {
            console.error('Error al cargar la imagen de la pelota');
        };

        // Dibujar barra
        function drawPaddle(x, y) 
        {
            context.fillStyle = '#fff';
            context.fillRect(x, y, paddleWidth, paddleHeight);
        }

        // Dibujar pelota
        function drawBall(x, y) 
        {
            context.drawImage(ballImage, x, y, ballSize, ballSize);
        }

        // Dibujar línea discontinua
        function drawNet() 
        {
            context.setLineDash([10, 10]); // Patron de línea discontinua
            context.beginPath();
            context.moveTo(canvasWidth / 2, 0);
            context.lineTo(canvasWidth / 2, canvasHeight);
            context.strokeStyle = '#fff';
            context.stroke();
            context.setLineDash([]); // Restablecer
        }

        // Dibujar puntuacion
        function drawScores() 
        {
            context.font = '30px Arial';
            context.fillStyle = '#fff';
            context.fillText(playerScore, canvasWidth / 4, 50);
            context.fillText(aiScore, (3 * canvasWidth) / 4, 50);

            context.font = '20px Arial';
            context.fillText('Player 1', canvasWidth / 4 - 30, 30);
            context.fillText('Player 2', (3 * canvasWidth) / 4 - 30, 30);
        }

        // Mover la barra del jugador
        function movePlayer() 
        {
            playerY += playerSpeed;
            if (playerY < 0) playerY = 0;
            if (playerY + paddleHeight > canvasHeight) playerY = canvasHeight - paddleHeight;
        }

        // Mover la barra de la IA, inganable con esto
        function moveAI() 
        {
            if (ballY > aiY + paddleHeight / 2) 
            {
                aiY += aiSpeed;
            } 
            else 
            {
                aiY -= aiSpeed;
            }
            if (aiY < 0) aiY = 0;
            if (aiY + paddleHeight > canvasHeight) aiY = canvasHeight - paddleHeight;
        }

        // Mover la pelota
        function moveBall() 
        {
            ballX += ballSpeedX;
            ballY += ballSpeedY;

            if (ballY < 0 || ballY + ballSize > canvasHeight) 
            {
                ballSpeedY *= -1;
            }

            // Colisiones con las barras del jugador y de la IA
            if ((ballX < playerX + paddleWidth && ballX + ballSize > playerX && ballY + ballSize > playerY && ballY < playerY + paddleHeight) || (ballX + ballSize > aiX && ballX < aiX + paddleWidth && ballY + ballSize > aiY && ballY < aiY + paddleHeight)) 
            {
                ballSpeedX *= -1;
                ballSpeedX += (ballSpeedX > 0 ? speedIncrement : -speedIncrement);
                ballSpeedY += (ballSpeedY > 0 ? speedIncrement : -speedIncrement);
            }

            if (ballX < 0) 
            {
                // Incrementar la puntuación de la IA
                aiScore++;
                // Reiniciar la pelota en el centro
                ballX = (canvasWidth - ballSize) / 2;
                ballY = (canvasHeight - ballSize) / 2;
                ballSpeedX = 4;
                ballSpeedY = 4;
            }

            if (ballX + ballSize > canvasWidth) 
            {
                // Incrementar la puntuación del jugador
                playerScore++;
                // Reiniciar la pelota en el centro
                ballX = (canvasWidth - ballSize) / 2;
                ballY = (canvasHeight - ballSize) / 2;
                ballSpeedX = 4;
                ballSpeedY = 4;
            }
        }

        // Actualizar el juego
        function update() 
        {
            movePlayer();
            moveAI();
            moveBall();
        }

        // Renderizar el juego
        function render() 
        {
            context.clearRect(0, 0, canvasWidth, canvasHeight);
            drawNet();
            drawPaddle(playerX, playerY);
            drawPaddle(aiX, aiY);
            drawBall(ballX, ballY);
            drawScores();
        }

        // Loop del juego
        function gameLoop() 
        {
            update();
            render();
            requestAnimationFrame(gameLoop);
        }

        // Flechas del teclado para mover la barra del jugador
        document.addEventListener('keydown', function(event) 
        {
            if (event.key === 'ArrowUp') 
            {
                playerSpeed = -6;
            } 
            else if (event.key === 'ArrowDown') 
            {
                playerSpeed = 6;
            }
        });

        document.addEventListener('keyup', function(event) 
        {
            if (event.key === 'ArrowUp' || event.key === 'ArrowDown') 
            {
                playerSpeed = 0;
            }
        });

        // No inicar hasta que se haya cargado la pelota
        ballImage.onload = function() 
        {
            gameLoop();
        };
    </script>
</body>
</html>
